/*!
 * 
 * phina-talkbubble 0.1.1
 * MIT Licensed
 * 
 * Copyright (C) pentamania, https://github.com/pentamania
 * 
 */!function(t){var i={};function e(n){if(i[n])return i[n].exports;var h=i[n]={i:n,l:!1,exports:{}};return t[n].call(h.exports,h,h.exports,e),h.l=!0,h.exports}e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var h in t)e.d(n,h,function(i){return t[i]}.bind(null,h));return n},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=1)}([function(t,i){t.exports=phina},function(t,i,e){"use strict";e.r(i);var n=e(0);n.namespace(function(){n.graphics.Canvas.prototype.talkBubble=function(t,i,e,n,h,a,r,s,o,l){var u,d,c=this.context,b=Math.PI,p=.5*Math.PI,f=t,g=i,T=t+e,v=i+n,S=t+.5*e,x=i+.5*n,k=h,y="right"===(a=a||"right")||"left"===a?g+n*r:f+e*r,m=.5*l;switch(s=s||l,a){case"right":u=T+s,d=x+o,c.arc(f+k,g+k,k,-b,-p,!1),c.arc(T-k,g+k,k,-p,0,!1),c.lineTo(T,y-m),c.lineTo(u,d),c.lineTo(T,y+m),c.arc(T-k,v-k,k,0,p,!1),c.arc(f+k,v-k,k,p,b,!1);break;case"left":u=f-s,d=x+o,c.arc(f+k,g+k,k,-b,-p,!1),c.arc(T-k,g+k,k,-p,0,!1),c.arc(T-k,v-k,k,0,p,!1),c.arc(f+k,v-k,k,p,b,!1),c.lineTo(f,y+m),c.lineTo(u,d),c.lineTo(f,y-m);break;case"bottom":u=S+o,d=v+s,c.arc(f+k,g+k,k,-b,-p,!1),c.arc(T-k,g+k,k,-p,0,!1),c.arc(T-k,v-k,k,0,p,!1),c.lineTo(y+m,v),c.lineTo(u,d),c.lineTo(y-m,v),c.arc(f+k,v-k,k,p,b,!1);break;default:u=S+o,d=g-s,c.arc(f+k,g+k,k,-b,-p,!1),c.lineTo(y-m,g),c.lineTo(u,d),c.lineTo(y+m,g),c.arc(T-k,g+k,k,-p,0,!1),c.arc(T-k,v-k,k,0,p,!1),c.arc(f+k,v-k,k,p,b,!1)}return c.closePath(),this},n.graphics.Canvas.prototype.fillTalkBubble=function(t,i,e,n,h,a,r,s,o,l){return this.beginPath().talkBubble(t,i,e,n,h,a,r,s,o,l).fill()},n.graphics.Canvas.prototype.strokeTalkBubble=function(t,i,e,n,h,a,r,s,o,l){return this.beginPath().talkBubble(t,i,e,n,h,a,r,s,o,l).stroke()}}),n.namespace(function(){n.graphics.Canvas.prototype.thornedTalkBubble=function(t,i,e,n,h,a,r,s){for(var o=this.context,l=h,u=r||.5*h,d=s||2*a,c=[],b=[],p=.6*d,f=1.6*u,g=Math.max(d,p),T=Math.max(u,f),v=(e-2*g)/l|0,S=(n-2*T)/a|0,x=t+g,k=t+e-g,y=i+T,m=i+n-T,P=0;P<S;P++)c.push({x:k,y:y+a*(P+.5)}),b.push({x:x,y:m-a*(P+.5)});o.beginPath(),o.moveTo(x,y);for(P=0;P<v;P++){var w=x+P*l;o.lineTo(w+.25*l,y),o.lineTo(w+.25*l*2,y-u),o.lineTo(w+.25*l*3,y),P!==v-1&&o.lineTo(w+l,y)}o.quadraticCurveTo(k,y,k+p,y-f);P=0;for(var z=c.length;P<z;P++)P%2==0?o.quadraticCurveTo(c[P].x,c[P].y,k+.8*d,y+(P+1)*a):o.quadraticCurveTo(c[P].x,c[P].y,k+d,y+(P+1)*a);for(o.quadraticCurveTo(k,m,k+p,m+f),P=v-1;0<=P;P--){w=x+P*l;o.lineTo(w+.25*l*3,m),o.lineTo(w+.25*l*2,m+u),o.lineTo(w+.25*l,m)}for(o.quadraticCurveTo(x,m,x-p,m+f),P=0,z=b.length;P<z;P++)P%2==0?o.quadraticCurveTo(b[P].x,b[P].y,x-.8*d,m-(P+1)*a):o.quadraticCurveTo(b[P].x,b[P].y,x-d,m-(P+1)*a);return o.quadraticCurveTo(x,y,x-p,y-f),o.closePath(),this},n.graphics.Canvas.prototype.fillThornedTalkBubble=function(t){return this.beginPath().thornedTalkBubble(x,y,width,height).fill()},n.graphics.Canvas.prototype.strokeThornedTalkBubble=function(t){return this.beginPath().thornedTalkBubble(x,y,width,height).stroke()}}),n.namespace(function(){n.define("phina.display.TalkBubbleShape",{superClass:"phina.display.Shape",init:function(t){t={}.$safe(t,{width:180,height:150,backgroundColor:"transparent",fill:"white",stroke:"black",strokeWidth:4,tipDirection:"right",tipBasePositionRatio:.5,tipBottomSize:10,cornerRadius:12,tipDeviation:0}),this.superInit(t),this.setBoundingType("rect"),this.cornerRadius=t.cornerRadius,this.tipDirection=t.tipDirection,this.tipBasePositionRatio=t.tipBasePositionRatio,this.tipBottomSize=t.tipBottomSize||.15*Math.min(t.width,t.height),this.tipProtrusion=t.tipProtrusion||this.tipBottomSize,this.tipDeviation=t.tipDeviation,this._fullWidth=t.width,this._fullHeight=t.height,this._resize()},_resize:function(){var t,i,e,n=this.bubbleWidth=this._cachedWidth!==this.width?this.width:this.bubbleWidth,h=this.bubbleHeight=this._cachedHeight!==this.height?this.height:this.bubbleHeight;"top"===this.tipDirection||"bottom"===this.tipDirection?(e=Math.abs(this.tipDeviation)-n/2,t=Math.max(n,n+2*e),i=Math.max(h,h+2*this.tipProtrusion)):(e=Math.abs(this.tipDeviation)-h/2,i=Math.max(h,h+2*e),t=Math.max(n,n+2*this.tipProtrusion)),this.setSize(t,i),this._cachedWidth=t,this._cachedHeight=i;var a=this.canvas,r=this.calcCanvasSize();a.setSize(r.width,r.height),a.clearColor(this.backgroundColor),a.transformCenter(),this._fullWidth=r.width,this._fullHeight=r.height},prerender:function(t){this._resize(),t.talkBubble(-this.bubbleWidth/2,-this.bubbleHeight/2,this.bubbleWidth,this.bubbleHeight,this.cornerRadius,this.tipDirection,this.tipBasePositionRatio,this.tipProtrusion,this.tipDeviation,this.tipBottomSize)},_defined:function(){n.display.Shape.watchRenderProperties(["cornerRadius","tipDirection","tipBasePositionRatio","tipBottomSize","tipProtrusion","tipDeviation"])},_accessor:{fullWidth:{get:function(){return this._fullWidth}},fullHeight:{get:function(){return this._fullHeight}}}})}),n.namespace(function(){n.define("phina.display.ThornedTalkBubbleShape",{superClass:"phina.display.Shape",init:function(t){t={}.$safe(t,{width:320,height:320,backgroundColor:"transparent",fill:"white",stroke:"black",sideThornInterval:15,sideThornSize:30,verticalThornInterval:20,verticalThornSize:10,strokeWidth:4,lineJoin:"miter",miterLimit:100}),this.superInit(t),this.setBoundingType("rect"),this.sideThornInterval=t.sideThornInterval,this.sideThornSize=t.sideThornSize||2*t.sideThornInterval,this.verticalThornInterval=t.verticalThornInterval,this.verticalThornSize=t.verticalThornSize||.5*t.verticalThornInterval,this.lineJoin=t.lineJoin,this.miterLimit=t.miterLimit},render:function(t){var i=t.context,e=this.calcCanvasSize();return t.setSize(e.width,e.height),t.clearColor(this.backgroundColor),t.transformCenter(),this.bubbleWidth=this.width-2*this.sideThornSize,this.bubbleHeight=this.height-2*this.verticalThornSize,t.thornedTalkBubble(-this.width/2,-this.height/2,this.width,this.height,this.verticalThornInterval,this.sideThornInterval,this.verticalThornSize,this.sideThornSize),this.isStrokable()&&(i.strokeStyle=this.stroke,i.lineWidth=this.strokeWidth,i.lineJoin=this.lineJoin,i.miterLimit=this.miterLimit,i.shadowBlur=0,this.renderStroke(t)),this.fill&&(i.fillStyle=this.fill,this.shadow?(i.shadowColor=this.shadow,i.shadowBlur=this.shadowBlur):i.shadowBlur=0,this.renderFill(t)),this},_defined:function(){n.display.Shape.watchRenderProperties(["verticalThornInterval","verticalThornSize","sideThornSize","sideThornInterval","lineJoin","miterLimit"])}})}),n.namespace(function(){n.display.Shape.prototype._getLines=function(){return this.label?(this.label.text+"").split("\n"):[]},n.display.Shape.prototype._getLabelWidth=function(){var t=this._lines?this._lines:this._getLines(),i=0,e=this.canvas;return e.context.font=this.label.font,t.each(function(t,n){var h=e.context.measureText(t).width;i=Math.max(i,h)}),i},n.display.Shape.prototype._getLabelHeight=function(){var t=this._lines?this._lines:this._getLines(),i=this.label.fontSize*t.length;return i*=this.label.lineHeight},n.display.Shape.prototype.adjustToLabelWidth=function(){return this.width=this._getLabelWidth()+2*this.padding,this},n.display.Shape.prototype.adjustToLabelHeight=function(){return this.height=this._getLabelHeight()+2*this.padding,this},n.display.Shape.prototype.adjustToLabelSize=function(){return this.adjustToLabelWidth().adjustToLabelHeight(),this}}),n.namespace(function(){n.define("phina.ui.TalkBubbleLabel",{superClass:"phina.display.TalkBubbleShape",init:function(t){t={}.$safe(t,{text:"Hello World!",bubbleFill:"white",bubbleStroke:"black",textFill:"black",textStroke:"transparent",fontSize:24,textPadding:6,fit:!0});var i={}.$extend(t,{backgroundColor:"transparent",padding:0,fill:t.textFill,stroke:t.textStroke}),e=this.label=n.ui.LabelArea(i),h={}.$extend(t,{width:e.width,height:e.height,fill:t.bubbleFill,stroke:t.bubbleStroke});this.superInit(h),this.addChild(e),this.text=t.text,this.textPadding=t.textPadding,t.fit&&(this.fitWhenChanged=!0,this.adjustToLabelSize());var a=this._dirtySync=!0;this.on("enterframe",function(){if(a){var t=this.calcCanvasSize();e.setPosition(t.width*(.5-this.originX),t.height*(.5-this.originY)),e.setSize(this.bubbleWidth-2*this.textPadding,this.bubbleHeight-2*this.textPadding),a=!1}});var r=function(t,i){t!==i&&(a=!0)};["bubbleWidth","bubbleHeight","textPadding"].forEach(function(t){this.$watch(t,r)},this),["x","y"].forEach(function(t){this.origin.$watch(t,r.bind(this))},this)},_accessor:{text:{get:function(){return this.label.text},set:function(t){this.label.text=t,this._lines=(this.label.text+"").split("\n"),this.fitWhenChanged&&this.adjustToLabelSize()}}}})}),n.namespace(function(){n.define("phina.ui.ThornedTalkBubbleLabel",{superClass:"phina.display.ThornedTalkBubbleShape",init:function(t){t={}.$safe(t,{text:"Hello World!",width:230,height:180,bubbleFill:"white",bubbleStroke:"black",textFill:"black",textStroke:"transparent",fontSize:24,textPadding:16,fit:!0});var i={}.$extend(t,{fill:t.bubbleFill,stroke:t.bubbleStroke});this.superInit(i);var e={}.$extend(t,{backgroundColor:"transparent",padding:0,fill:t.textFill,stroke:t.textStroke}),h=this.label=n.ui.LabelArea(e).addChildTo(this);this.textPadding=t.textPadding,t.fit&&(this.fitWhenChanged=!0,this.adjustToLabelSize());var a=!0;this.on("enterframe",function(){if(a){var t=this.calcCanvasSize(),i=2*this.textPadding;h.setPosition(t.width*(.5-this.originX),t.height*(.5-this.originY)),h.setSize(this.bubbleWidth-i,this.bubbleHeight-i),a=!1}});var r=function(t,i){t!==i&&(a=!0)};["bubbleWidth","bubbleHeight","textPadding"].forEach(function(t){this.$watch(t,r)},this),["x","y"].forEach(function(t){this.origin.$watch(t,r.bind(this))},this)},adjustToLabelWidth:function(){return this.width=this._getLabelWidth()+2*this.textPadding+2*this.sideThornSize,this},adjustToLabelHeight:function(){return this.height=this._getLabelHeight()+2*this.textPadding+2*this.verticalThornSize,this},_accessor:{text:{get:function(){return this.label.text},set:function(t){this.label.text=t,this.fitWhenChanged&&this.adjustToLabelSize()}}}})}),e.d(i,"phina",function(){return n})}]);